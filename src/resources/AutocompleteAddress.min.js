/*!
 * Postcode.nl international address autocompletion
 *
 * https://api.postcode.nl
 *
 * Copyright Postcode.nl
 * Released under the MIT license
 * https://tldrlegal.com/l/mit
 *
 * @author Postcode.nl
 * @version 1.3.2
 */
!function(e,t){"use strict";"function"==typeof define&&define.amd?define([],t):(e.PostcodeNl=e.PostcodeNl||{},e.PostcodeNl.AutocompleteAddress=t())}("undefined"!=typeof self?self:this,(function(){"use strict";const e=window.document,t=new WeakMap,n="Address",s=Object.create(null,{context:{value:"nld",writable:!0},autocompleteUrl:{writable:!0},addressDetailsUrl:{writable:!0},tags:{value:{"unvalidated-housenumber":"(unknown house number)","unvalidated-housenumber-addition":"(unknown house number addition)"},writable:!0},cssPrefix:{value:"postcodenl-autocomplete-",writable:!0},minLength:{value:1,writable:!0},delay:{value:300,writable:!0},appendTo:{value:e.body,writable:!0},autoFocus:{value:!1,writable:!0},autoResize:{value:!0,writable:!0},getResponseMessage:{value:function(e){let t;return t=e>1?e+" address suggestions available. ":"One address suggestion available. ",t+="Use up and down arrow keys to navigate.",t},writable:!0},language:{writable:!0}}),o=function(n){const s=this,o=e.createElement("ul"),i=e.createElement("div"),l={menuOpen:n.cssPrefix+"menu-open",itemFocus:n.cssPrefix+"item-focus"},a=function(e,n){if(0===o.children.length)return;const s=e?o.firstElementChild:o.lastElementChild,i=e?o.lastElementChild:o.firstElementChild;if(void 0===n&&(n=!0),r(),null===v)v=s;else{if(v===i)return v=null,d.value=f,void(t.get(d).context=p);v=(e?v.nextElementSibling:v.previousElementSibling)||s}v.classList.add(l.itemFocus),o.scrollTop>v.offsetTop?o.scrollTop=v.offsetTop:v.offsetHeight+v.offsetTop>o.clientHeight&&(o.scrollTop=v.offsetHeight+v.offsetTop-o.clientHeight);const a=t.get(v);n&&!0===d.dispatchEvent(new CustomEvent("autocomplete-focus",{detail:a,cancelable:!0,bubbles:!0}))&&(d.value=a.value,t.get(d).context=a.context)},r=function(){null!==v&&v.classList.remove(l.itemFocus)},c=function(e){h&&e.target!==d&&!i.contains(e.target)&&s.close()},u=function(){h&&s.close()};let d,f,p,h=!1,m=!1,v=null;Object.defineProperties(this,{isOpen:{get:function(){return h}},isMousedown:{get:function(){return m}},hasFocus:{get:function(){return null!==v}},wrapper:{get:function(){return i}},ul:{get:function(){return o}}}),i.classList.add(n.cssPrefix+"menu"),o.classList.add(n.cssPrefix+"menu-items"),i.appendChild(o),o.addEventListener("mousemove",(function(e){if(e.target===v||e.target===o)return;r();let t=e.target;for(;t.parentElement!==o;)t=t.parentElement;v=t,v.classList.add(l.itemFocus)})),o.addEventListener("mouseout",(function(){r(),v=null})),i.addEventListener("mousedown",(function(){m=!0})),i.addEventListener("click",(function(e){e.preventDefault(),null!==v&&s.select(),window.setTimeout((function(){m=!1}))})),HTMLElement.prototype.isPrototypeOf(n.appendTo)?n.appendTo.appendChild(i):(e.querySelector(n.appendTo)||e.body).appendChild(i),this.setItems=function(e,n){o.innerHTML="",o.scrollTop=0;for(let s,i,l=0;i=e[l++];)s=n(o,i),t.set(s,i);v=null},this.open=function(e){d=e,f=d.value,p=t.get(d).context,n.autoFocus&&null===v&&this.focusNext(!1),h||(!function(e){const t=e.getBoundingClientRect();i.style.top=t.bottom+(window.scrollY||window.pageYOffset)+"px",i.style.left=t.left+(window.scrollX||window.pageXOffset)+"px",n.autoResize&&(i.style.width=t.width+"px")}(d),i.classList.add(l.menuOpen),o.scrollTop=0,h=!0,d.dispatchEvent(new CustomEvent("autocomplete-open",{bubbles:!0})))},this.close=function(e){h&&(e&&(d.value=f,t.get(d).context=p),r(),v=null,i.classList.remove(l.menuOpen),h=!1,d.dispatchEvent(new CustomEvent("autocomplete-close",{bubbles:!0})))},this.focusPrevious=a.bind(this,!1),this.focusNext=a.bind(this,!0),this.blur=function(){null!==v&&(v.classList.remove(l.itemFocus),v=null)},this.select=function(){const e=t.get(v);!0===d.dispatchEvent(new CustomEvent("autocomplete-select",{detail:e,cancelable:!0,bubbles:!0}))&&(d.value=e.value),d.focus()},this.clear=function(){r(),v=null,o.innerHTML=""},this.destroy=function(){return null!==i.parentNode&&(i.parentNode.removeChild(i),e.removeEventListener("click",c),window.removeEventListener("resize",u),!0)},e.addEventListener("click",c),window.addEventListener("resize",u)},i=function(){const e=new Uint8Array(32),t=[],n="0123456789abcdef";(window.crypto||window.msCrypto).getRandomValues(e);for(let s=0,o=n.length;s<32;s++)t.push(n[e[s]%o]);return t.join("")};if("function"!=typeof window.CustomEvent){const t=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:null};var s=e.createEvent("CustomEvent");return s.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),s};window.CustomEvent=t}0===window.DOMTokenList.prototype.toggle.length&&(window.DOMTokenList.prototype.toggle=function(e){return arguments.length>1?(this[arguments[1]?"add":"remove"](e),!!arguments[1]):(this[this.contains(e)?"remove":"add"](e),this.contains(e))});const l=function(l,a){let r;if("string"==typeof l)c=l,r=e.querySelectorAll(c);else if(HTMLElement.prototype.isPrototypeOf(l))r=[l];else{if(!NodeList.prototype.isPrototypeOf(l))throw new TypeError("Element(s) or selector has invalid type. Use HTMLElement, NodeList or valid CSS selector string.");r=l}var c;if(0===r.length)return;(a=function(e,t){for(let n in t)e[n]=t[n];return e}(Object.create(s),a)).context=a.context.toLowerCase(),Object.defineProperty(this,"options",{get:function(){return a}});let u=null,d=null,f=null,p=null,h=null,m=[];const v=this,g=new o(a),b=a.cssPrefix+"address-input-blank",w=i(),E=e.createElement("div"),L="aria-live-region";E.id=function(t){let n=2,s=t;for(;null!==e.getElementById(s);)s=t+"-"+n,n++;return s}(L),E.setAttribute("aria-role","status"),E.setAttribute("aria-live","assertive"),E.classList.add(a.cssPrefix+L),e.body.appendChild(E),window.addEventListener("beforeunload",(function(){window.clearTimeout(u)})),Object.defineProperty(this,"elements",{get:function(){return{menu:g.wrapper,menuItems:g.ul,liveRegion:E}}}),this.announce=function(e){E.innerHTML="<div>"+e+"</div>"},this.xhrGet=function(e,n){null!==p&&p.readyState<4&&p.abort(),p=new XMLHttpRequest,p.addEventListener("load",(function(){200===this.status&&n.call(this,JSON.parse(p.response))}));let s=w;if(null!==h){const e=h,n=function(t){200!==this.status&&e.dispatchEvent(new CustomEvent("autocomplete-error",{detail:{event:t,request:this},bubbles:!0}))};s=t.get(e).sessionId,p.addEventListener("error",n),p.addEventListener("load",n),e.classList.add(a.cssPrefix+"loading"),p.addEventListener("loadend",(function(){e.classList.remove(a.cssPrefix+"loading")}))}return p.open("GET",e),p.setRequestHeader("X-Autocomplete-Session",s),p.send(),p},this.getSuggestions=function(e,t,n){let s=this.options.autocompleteUrl+"/"+encodeURIComponent(e)+"/"+encodeURIComponent(t);return void 0!==a.language&&(s+="/"+a.language),this.xhrGet(s,n)},this.getDetails=function(e){let t=null,n=arguments[1];const s=[e];return 3===arguments.length&&(t=arguments[1],n=arguments[2],s.push(t)),this.xhrGet(this.options.addressDetailsUrl+"/"+s.join("/"),n)},this.renderItem=function(t,s){const o=e.createElement("li"),i=e.createElement("span");if(o.classList.add(this.options.cssPrefix+"item"),i.classList.add(this.options.cssPrefix+"item-label"),i.innerHTML=this.highlight(s.label,s.highlights),o.appendChild(i),s.precision!==n&&o.classList.add(this.options.cssPrefix+"item-more"),s.description){const t=e.createElement("span");t.textContent=s.description,t.classList.add(this.options.cssPrefix+"item-description"),o.appendChild(t)}if(s.tags)for(let t,n=0;t=s.tags[n++];){const n=e.createElement("em");n.textContent=this.options.tags[t],n.classList.add(this.options.cssPrefix+"item-tag"),o.appendChild(n)}return t.appendChild(o),o},this.highlight=function(e,t){if(0===t.length)return e;let n,s=0,o=0,i=0,l=[];for(;n=t[s++];)l.push(e.slice(i,n[0])),o=n[0],i=n[1],l.push("<mark>"+e.slice(o,i)+"</mark>");return l.push(e.slice(i)),l.join("")},this.setCountry=function(e){a.context=e.toLowerCase();for(let e,n=0;e=r[n++];)t.get(e).context=a.context},this.setLanguage=function(e){a.language=e},this.search=function(e,n,s){if(void 0!==n&&(e.value=n),void 0!==s){const n=t.get(e);n.context=s,t.set(e,n)}h=e,e.classList.toggle(b,""===e.value),y(e)},this.reset=function(){d=null,f=null,m=[],g.clear();for(let e,n=0;e=r[n++];){const n=t.get(e);n.context=a.context,n.match={},e.value="",e.classList.add(b)}},this.destroy=function(){if(g.destroy()){e.body.removeChild(E);for(let e,o=0;e=r[o++];){const o=t.get(e);for(var n in o.eventHandlers)e.removeEventListener(n,o.eventHandlers[n]);for(var s in o.initialAttributeValues){const t=o.initialAttributeValues[s];null===t?e.removeAttribute(s):e.setAttribute(s,t)}t.delete(e),e.classList.remove(a.cssPrefix+"address-input",a.cssPrefix+"loading",b)}}},Array.prototype.forEach.call(r,(function(e){const s=Object.create(null);let o=!1;t.set(e,{match:{},context:a.context,eventHandlers:s,initialAttributeValues:{spellcheck:e.hasAttribute("spellcheck")?e.getAttribute("spellcheck"):null,autocomplete:e.hasAttribute("autocomplete")?e.getAttribute("autocomplete"):null,"aria-controls":e.hasAttribute("aria-controls")?e.getAttribute("aria-controls"):null},sessionId:i()}),!1===e.hasAttribute("autocomplete")&&(e.autocomplete="off"),e.spellcheck=!1,e.setAttribute("aria-controls",E.id),e.classList.add(a.cssPrefix+"address-input"),e.classList.toggle(b,""===e.value),e.addEventListener("keydown",s.keydown=function(t){switch(o=!0,t.key){case"ArrowUp":case"Up":g.isOpen?g.focusPrevious():y(e),t.preventDefault();break;case"ArrowDown":case"Down":g.isOpen?g.focusNext():y(e),t.preventDefault();break;case"Escape":case"Esc":g.close(!0);break;case"Tab":g.hasFocus&&(g.select(),t.preventDefault());break;case"Enter":g.hasFocus?(g.select(),t.preventDefault()):g.close();break;default:x(e)}}),e.addEventListener("input",s.input=function(){e.classList.remove(b),g.blur(),m=[],o?o=!1:x(e)}),e.addEventListener("focus",s.focus=function(){if(g.isMousedown)return;g.open(e);const s=t.get(e);void 0!==s.match.precision&&s.match.precision===n||y(e)}),e.addEventListener("click",s.click=g.open.bind(g,e)),e.addEventListener("autocomplete-select",s["autocomplete-select"]=function(s){const o=t.get(e);o.match=s.detail,s.detail.precision===n?g.close():(g.open(e),o.context=s.detail.context,window.setTimeout(y,0,e))}),e.addEventListener("blur",s.blur=function(){g.isMousedown||(window.clearTimeout(u),g.close(),e.classList.toggle(b,""===e.value))}),e.dispatchEvent(new CustomEvent("autocomplete-create",{detail:v,bubbles:!0}))}));const x=function(e){window.clearTimeout(u);let t=10;e.value.length>3&&(t=a.delay),u=window.setTimeout(y,t,e)},y=function(e){g.open(e);const n=t.get(e);if(h=e,e.value===d&&n.context===f)return;const s=n.context===f&&null!==d&&(0===e.value.indexOf(d)||0===d.indexOf(e.value));if(d=e.value,f=n.context,n.match={},e.value.length<a.minLength)return n.context=a.context,void g.clear();!1!==e.dispatchEvent(new CustomEvent("autocomplete-search",{cancelable:!0,bubbles:!0}))&&v.getSuggestions.call(v,n.context,e.value,(function(t){if(!0===e.dispatchEvent(new CustomEvent("autocomplete-response",{detail:t,cancelable:!0,bubbles:!0}))){if(m=t.matches||[],s&&0===m.length)return;g.setItems(m,v.renderItem.bind(v)),v.announce(a.getResponseMessage(m.length,a.language)),a.autoFocus&&g.focusNext(!1)}}))}};return Object.defineProperty(l,"defaults",{get:function(){return s}}),Object.defineProperty(l,"version",{value:"1.3.2"}),l}));